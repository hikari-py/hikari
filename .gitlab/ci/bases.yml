# Copyright (c) 2020 Nekokatt
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.

###
### Mark a job as having reactive defaults, such as firing on merge requests,
### new tags, new branches, schedules, new commits; all by default.
###
.reactive-job:
  artifacts:
    expire_in: 2 days
  rules:
    - if: "$CI_PIPELINE_SOURCE == 'web'"
    - if: "$CI_PIPELINE_SOURCE == 'schedule'"
    - if: "$CI_PIPELINE_SOURCE == 'push'"
    - if: "$CI_PIPELINE_SOURCE == 'merge_request_event'"

.busybox:musl:
  image: busybox:1.31.1-musl

.cpython:3.8.0:
  image: python:3.8.0

.cpython:3.8.1:
  image: python:3.8.1

.cpython:3.8.2:
  image: python:3.8.2

.cpython:3.8.3:
  image: python:3.8.3

.cpython:3.8.4:
  image: python:3.8.4

.cpython:3.8.5:
  image: python:3.8.5

.cpython:3.8:
  image: python:3.8

.cpython:3.9rc:
  image: python:3.9-rc

.cpython:
  extends:
    - .cpython:3.8

.stackless:3.8-rc:
  image: nekokatt/stackless-python-hikari:3.8.0-rc

# Shared windows runner. Does not use docker.
# Python will need to be installed manually.
.win32:
  before_script:
    - choco install --no-progress python -y
    - if (!(test-path "public")) { New-Item -ItemType Directory -Force -Path public }
    - refreshenv
    - py -3 -V
    - py -3 -m pip install nox
  extends:
    - .reactive-job
  tags:
    - shared-windows
    - windows
    - windows-1809
